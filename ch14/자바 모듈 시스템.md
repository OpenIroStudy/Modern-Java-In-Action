![image](https://user-images.githubusercontent.com/67637716/167344413-f5a09536-4e5f-49b7-9f0a-001acf0cc02c.png)  
자바9에서 가장 많이 거론되는 새로운 기능이다.  
모듈시스템은 Jigsaw 프로젝트 내부에서 개발된 십년이 걸린 기능.  
<br>

# 소프트웨어 유추
### 관심사 분리
Separation of Concern 은 컴퓨터 프로그램을 고유의 기능으로 나누는 동작을 권장하는 원칙  
* 개별 기능을 따로 작업할 수 있고 팀이 쉽게 협업한다
* 개별 부분을 재사용하기 쉽다
* 전체 시스템을 쉽게 유지보수 할 수 있다.  

### 정보 은닉
세부구현을 숨기도록 장려하는 원칙
* 세부구현을 숨김으로써 프로그램의 부분을 바꿨을때 다른 부분까지 영향을 미칠 가능성을 줄일 수 있다.
* 캡슐화된 코드의 내부적 변화가 외부에 끼칠 영향을 줄일 수 있다.  


클래스 내 private 키워드를 사용했는지 기준으로 컴파일러를 이용해 캡슐화를 확인할 수 있는데,  
자바9 이전까지 클래스와 패키지가 의도된대로 공개되었는지 컴파일러로 확인할 수 있는 기능이 없었다.  

### 자바 소프트웨어

자바는 객체지향 언어로 특정문제와 관련된 패키지, 클래스, 인터페이스를 그룹으로 만들어 코드를 그룹화할 수 있다.  
코드만 보고 동작을 추론하기 어려우니 UML 다이어그램을 이용하면 시각적으로 코드 의존성을 보여줄 수 있다.  

# 자바 모듈 시스템을 설계한 이유  
java 9이전에는 클래스, 패키지, JAR 세가지 수준의 코드 그룸화를 제공하였다.  
클래스 관련해 접근제한자와 캡슐화를 지원했지만 패키지와 JAR 수준에서는 캡슐화를 거의 지원하지 않았다.  

### 제한된 가시성 제어
public, protected, default, private 네가지 가시성 접근자  
한 패키지의 클래스와 인터페이스를 다른 패키지로 공개하려면 public으로 선언해야 하기에 결과적으로 클래스와 인터페이스는 모두 공개된다.  
내부적으로 사용할 목적으로 만든 구현을 다른 프로그래머가 임시적으로 사용해 기존의 애플리케이션을 망가뜨리지 않고 라이브러리 코드를 바꾸기가 어려워짐.  
보안 측면에서 코드가 노출되었으므로 코드를 임의로 조작하는 위협에 더 많이 노출.  

### 클래스 경로
클래스를 모두 컴파일 후 보통 한개의 jar 파일에 넣고 클래스 경로에 JAR 파일을 추가해 사용할 수 있다.  
그러면 JVM이 동적으로 클래스 경로에 정의된 클래스를 필요할 때 읽는다.  
1. 클래스 경로에는 같은 클래스를 구분하는 버전 개념이 없음.
다양한 컴포넌트가 같은 라이브러리의 다른 버전을 사용할 경우 문제  

2. 클래스 경로는 명시적인 의존성을 지원하지 않음.  
각각의 JAR 안에 있는 모든 클래스는 classes로 합쳐진다.  
한 JAR 이 다른 JAR에 포함된 클래스 집합을 사용하라고 명시적으로 의존성을 정의하는 기능을 제공하지 않음.  

=> 충돌이 있는가 하는 의문  
=> 클래스 경로 지옥이라 부름(ClassNotFoundException)  

따라서 메이븐이나 그레들 같은 빌드 도구를 사용해 문제를 해결한다.  
자바 자체적으로는 명시적 의존성 정의를 지원하지 않았다.  


### 거대한 JDK
자바 프로그램을 만들고 실행하는데 도움을 주는 도구의 집합.  
- 자바 프로그램을 컴파일하는 javac, 애플리케이션을 로드하고 실행하는 java, 입출력 호함 런타임 지원을 제공하는 JDK 라이브러리,컬렉션,스트림 등.  
JDK 자체도 모듈화할 수 있는 자바 모듈 시스템 설계의 필요성 제기  
JDK에서 필요한 부분만 골라쓰고, 클래스 경로를 쉽게 유추할 수 있으며, 플랫폼을 진화시킬 수 있는 강력한 캡슐화를 제공할 건축구조 필요.  


### 자바 모듈 : 큰 그림
자바8은 모듈이라는 새로운 자바 프로그램 구조단위를 제공.  
module이라는 새 키워드에 이름과 바디를 추가해서 정의.  
모듈 디스크립터 ( module-info.class에 저장된 바이너리 형식)는 moduel-info.java라는 파일에 저장.  

```  
// moduel-info.java 자바 모듈 디스크립터의 핵심 구조
module 모듈명

exports 패키지명

requires 모듈명
```  
메이븐 같은 도구에서 모듈의 많은 세부사항을 IDE가 처리함.  


# 자바 모듈 시스템으로 애플리케이션 개발하기
모듈화 애플리케이션을 실행하기  
1. 프로젝트의 모듈 소스 디렉터리에서 다음 명령 실행
``` java
javac module-info.java com/example/.../...java -d target
// -d : javac는 클래스가 있는 디렉터리에 클래스 파일을 생성. 
//      이 옵션을 제공하면, 해당 디렉터리도 생성하고, 관련된 패키지 디렉터리도 생성하여 클래스 파일을 만들어준다.

jar cvfe JAR파일.jar com.example... -C target
```  
2. 어떤 폴더와 클래스 파일이 생성된 JAR에 포함되어 있는지를 보여주는 결과 출력

3. 생성된 jar를 모듈화 애플리케이션으로 실행
``` java
java --module-path JAR파일.jar \ --module 모듈명/클래스명

// --module-path : 어떤 모듈을 로드할 수 있는지 지정. 클래스 파일을 지정하는 --classpath 와는 다름
// --module : 이 옵션은 실행할 메인 모듈과 클래스를 지정
```  
![image](https://user-images.githubusercontent.com/67637716/167359533-27f7c2ca-31ba-4d12-a5e2-537acbd54dc3.png)



# 여러 모듈 활용하기
### exports 구문
``` java
module expenses.readers {
    exports com.example.expenses.readers;
    exports com.example.expenses.readers.file;
    exports com.example.expenses.readers.http;
    // 패키지명
}
```  
exports는 다른 모듈에서 사용할 수 있도록 특정 패키지를 공개 형식으로 만든다.  

### requires 구분
의존하고 있는 모듈을 지정.  
``` java  
module expenses.readers {
    requires java.base; // 모듈명

    exports com.example.expenses.readers;
    exports com.example.expenses.readers.file;
    exports com.example.expenses.readers.http;
    // 패키지명
}
```  
requires는 의존하고 있는 모듈을 지정  
java.base는 모든 모듈이 의존되어있기 때문에(net, io, util 등 패키지 포함) 명시적으로 정의할 필요 없다.  


=============================================================================================================

# gradle 멀티 프로젝트 만들기
1. root 프로젝트를 새로 만든후, 필요 없는 src폴더 등 삭제  
2. root 프로젝트 안에 프로젝트들을 복사 후 이동 ( 이 때 IDE의 workspace에 같은 이름의 프로젝트가 있으면 인식 안됨.)
3. 멀티 프로젝트도 필요 없는 파일 삭제  
![image](https://user-images.githubusercontent.com/67637716/167521171-9add1c33-3978-42eb-82e5-3a5f3be8c4c5.png)  
4. root의 settings.gradle에 밑의 그림과 같이 작성   
![image](https://user-images.githubusercontent.com/67637716/167521227-b9395e90-0b19-4de3-a7d1-ef1670836ad3.png)  
5. build.gradle 작성법
    * 기본적으로 root의 build.gradle에 작성시 멀티 프로젝트에 공통으로 적용됨.
    * 멀티 프로젝트 : 특별하게 의존성이 필요한 것만 주입
    * ![image](https://user-images.githubusercontent.com/67637716/167521338-8dbf4ee8-d668-4fc6-8b9a-306a4fc6fe10.png)

## root build.gradle 작성
``` java
buildscript {
    ext {
        springBootVersion = '2.3.4.RELEASE'
        dependencyManagementVersion = '1.0.10.RELEASE'
    }

    repositories {
        mavenLocal()
        maven {
            url "$repoUrl/reop-public"
            allowInsecureProtocol = true
            credentials {
                username "$repoUsername" 
                password "$repoPassword"
            }
        }
    }
    
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath("io.spring.gradle:dependency-management-plugin:${dependencyManagementVersion}")
    }
}

plugins {
    id 'base'
    id 'java'
}

allprojects {
    group = 'kr.co.openlabs'
    version = '0.0.1-SNAPSHOT'
    sourceCompatibility = '1.8'
}

subprojects {
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'
    apply plugin: 'java-library'
    apply plugin: 'java'

    repositories {
        mavenLocal()
        maven {
            url "$repoUrl/repo-public"
            allowInsecureProtocol = true
            credentials {
                username "$repoUsername" 
                password "$repoPassword"
            }
        }
    }

    dependencies {

        implementation('kr.co.repo:openIroStudy-project:0.0.1-SNAPSHOT') {
            changing=true
        }

        runtimeOnly 'com.oracle.ojdbc:ojdbc8:19.3.0.0'
        runtimeOnly 'mysql:mysql-connector-java'
        runtimeOnly 'org.mariadb.jdbc:mariadb-java-client'
        runtimeOnly 'org.postgresql:postgresql'

        implementation 'io.springfox:springfox-swagger2:3.0.0'
        implementation 'io.springfox:springfox-swagger-ui:3.0.0'
		
		implementation 'org.springframework.boot:spring-boot-starter-web'
		
		// mybatis        
		implementation 'org.mybatis:mybatis:3.5.6'
		implementation 'org.mybatis:mybatis-spring:1.3.2'
		
		implementation 'org.springframework.boot:spring-boot-starter-webflux'
    
        compileOnly 'org.projectlombok:lombok'
        developmentOnly 'org.springframework.boot:spring-boot-devtools'
        annotationProcessor 'org.projectlombok:lombok'
        testImplementation 'org.springframework.boot:spring-boot-starter-test'
        implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
        
        // https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient
    	implementation 'org.apache.httpcomponents:httpclient:4.5.13'
    	
    	testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.1'
    	testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.1'
    }

    test {
        useJUnitPlatform()
    }
}

```  





![image](https://user-images.githubusercontent.com/67637716/167520964-0e5f4867-788d-4015-946f-856f67d6d0f7.png)


